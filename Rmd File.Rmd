---
title: "Rmd File"
author: "Arielle Dror, Kara Van Allen, Emily Daubenspeck"
date: "November 18, 2018"
output: html_document
---
First Rough Draft

```{r, message = FALSE, warning = FALSE}
library(tidyverse)
library(igraph)
library(readr)
library(sna)
<<<<<<< HEAD
library(ggplot2)
library(mosaic)
=======
library(blockmodels)
>>>>>>> c3d3435930354497b48130922c8e61df9be5dd7a

bill_sponsers_data <- read_csv("bill_sponsers_data.csv")
length(unique(bill_sponsers_data$bill_number))

bill_sponsers_data <- bill_sponsers_data %>%
  mutate(sponsor = ifelse(position == 1, TRUE, FALSE))

node_characteristics <- read_csv("node_characteristics.csv")
```

``` {r}
split_name <- str_split_fixed(node_characteristics$Name, " ", 3)
  
node_characteristics <- node_characteristics %>%
  mutate(firstLast = paste(split_name[, 2], split_name[, 1], sep = ' ')) %>%
  mutate(firstLast = gsub(',', replacement = '', firstLast)) %>%
  mutate(firstLast = if_else(firstLast == "Hollen Van", "Chris Van Hollen", firstLast)) %>%
  mutate(firstLast = if_else(firstLast == "Catherine Masto", "Catherine Cortez Masto", firstLast)) %>%
  mutate(weight = (`Number of bills cosponsered` + `Number of bills sponsered`)/3600)

names_people <- c(node_characteristics$firstLast)

short_sponsors <- bill_sponsers_data %>%
  select(bill_number, name)
cosponsors <- c(short_sponsors$name)

cosponsors<-unique(cosponsors)

node_characteristics_temp <- node_characteristics %>%
  select(firstLast, State, Gender, Age, weight)

node_characteristics_temp$firstLast <- node_characteristics_temp$firstLast[order(match(node_characteristics_temp$firstLast,cosponsors))]

node_characteristics_final <- left_join(node_characteristics_temp, node_characteristics, by = "firstLast")
node_characteristics_final <- node_characteristics_final %>%
  select(firstLast, State.y:weight.y) %>%
  rename(State = State.y,
         Age = Age.y,
         Gender = Gender.y,
         Weight = weight.y)


#node_characteristics <- node_characteristics %>%
 #mutate(firstLast = node_characteristics_order)

mat<-diag(105) #check this :)

diag(mat)<-0 
for(n in unique(short_sponsors$bill_number)) {
  short_sponsors_temp <- short_sponsors %>%
   filter(bill_number == n)
   names_people<-short_sponsors_temp$name
 
mat[cosponsors%in%(names_people), cosponsors%in%(names_people)] <- mat[cosponsors%in%(names_people), cosponsors%in%(names_people)] + 1
#end loop
}

diag(mat)<-0


<<<<<<< HEAD
attempt <- function(bill_num){
  filter(short_sponsors$bill_number == bill_num)
  cosponsors <- c(short_sponsors$name)
  mat[cosponsors, cosponsors] <- mat[cosponsors, cosponsors] + 1
}


diag(mat)<-0
  

```

```{r}
sponser_matrix_full <- as.matrix(mat)
sponser_matrix <- as.matrix(mat)
upper.tri(sponser_matrix, diag = TRUE)
diag(sponser_matrix) <- NA
sponser_matrix[upper.tri(sponser_matrix)] <- NA

x <- cbind(which(!is.na(sponser_matrix), arr.ind = TRUE), na.omit(as.vector(sponser_matrix)))
weighteddf <- as.data.frame(x)



attempt1 <- graph.adjacency(sponser_matrix, mode = "undirected", weighted = TRUE)
plot(attempt1)

plot(attempt1, layout=layout.fruchterman.reingold)

plot(attempt1)

sponser_matrixg <- graph.adjacency(sponser_matrix1, mode = "undirected", weighted = TRUE)
plot(sponser_matrixg)
```

```{r}
sbm_attempt <- BM_bernoulli("SBM", sponser_matrix_full)
sbm_attempt2 <- BM_bernoulli(
    "SBM", 
    sponser_matrix_full, 
    verbosity=6,
    autosave='',
    plotting=character(0),
    exploration_factor=1.5,
    explore_min=2,
    explore_max=7,
    ncores=detectCores())
sbm_attempt2$estimate()
which.max(sbm_attempt$ICL)
num.clusters<-3
# sbm_attempt$memberships[[num.clusters]]$Z #gives probability of being in each group
sbm_attempt$memberships[[num.clusters]]$plot() #plots the group memberships

sbm_attempt2
```